---
// import incomingData from "@/data/temp_users/testing-tas-datasource.json";
import SocialMediaItem from "@/components/SocialMediaItem.astro";
import TASProfile from "@/layouts/TASProfile.astro";
import fetchApi from "@/lib/strapi";

export async function getStaticPaths() {
  const data: any = await fetchApi({
    endpoint: "/businesses/kahete-test/all-employees",
  });
  const incomingData = data.profiles;
  return incomingData.map((entry: any) => ({
    params: {
      slug: entry.slug,
    },
    props: { entry },
  }));
}

const { entry } = Astro.props as any;

const data: any = entry.basic_user_profile;
---

<TASProfile
  username={entry.basic_user_profile.full_name}
  title={entry.basic_user_profile.title}
  about={entry.basic_user_profile.about}
  email={entry.basic_user_profile.email}
  profile_picture={entry.basic_user_profile.profile_picture}
  phone_number={entry.basic_user_profile.phone_number.toString()}
  whatsapp={entry.basic_user_profile.whatsapp_number.toString()}
>
  {
    entry.social_links.map(
      (socialMedia: { type: any; link: string; optional_name?: string }) => {
        return (
          <SocialMediaItem
            socialMediaType={socialMedia.type}
            url={socialMedia.link}
            optionalName={socialMedia.optional_name}
          />
        );
      }
    )
  }
</TASProfile>
